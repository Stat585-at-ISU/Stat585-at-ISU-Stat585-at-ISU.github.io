{
  "hash": "febb6ff2ec230994534f249a2d4184a6",
  "result": {
    "markdown": "---\ntitle: 'Fixing a thing'\nauthor: 'CdS'\ndate: '2023-03-30'\ncategories: 'Errors and warnings in packages'\noutput: github_document\n---\n\n\n<!-- README.md is generated from README.Rmd. Please edit that file -->\n<!-- badges: start -->\n[![Frontmatter check](../../actions/workflows/check-yaml.yaml/badge.svg)](../../actions/workflows/check-yaml.yaml)\n<!-- badges: end -->\n\n## Prompt:\n\nFix one of the problems in one of our community packages at `https://github.com/Stat585-at-ISU/lab-3-all-all-for-one-and-one-for-all`, and write about it. \n\n## Instructions:\n\nWhat we want to know is the **exact** warning or error message of the item you fixed, and a description of what you did, also as specific as possible. \n\nDescribe your experience  below. Push this blog post to your blog-9 repo. Make sure the front matter check passes.\n\n**Which error or warning did you fix? ... and how?**\n\n\nFor this week's blog, I decided to keep working on the ***Team2*** package. The warning I identified dealt with us forgetting to include a library in the ***Imports*** section of the description, and using *library* within the functions. \nThe error would be similar to the following message:\n```\n checking dependencies in R code ... WARNING\n  'library' or 'require' calls not declared from:\n    'tabulizer' 'tidyverse'\n  'library' or 'require' calls in package code:\n    'tabulizer' 'tidyverse'\n    Please use :: or requireNamespace() instead.\n    See section 'Suggested packages' in the 'Writing R Extensions' manual.\n```\n\nThe reason for this was that within the function *pdf_to_table* we were importing the library, like this:\n```\npdf_to_tbl <- function(pdf, save_as = NULL) {\n\n  library(tidyverse)       <--------- This command was problematic\n  library(tabulizer)       <--------- This command was problematic\n \n  plog <- tabulizer::extract_tables(file = pdf, method = \"lattice\")\n  df <- lapply(plog, extract_data_frame_page)\n\n  # identify the numeric columns, since some pages miss all \"Report Number Assigned to Event\"\n  n <- length(df)\n  numeric_columns <- df %>% lapply(., function(x)sapply(x, class)) %>%\n    lapply(., function(x)which(x == \"numeric\")) %>%\n    unlist %>% unique\n\n  ## Combining the different pages\n  df <- do.call(rbind, df)\n  df[numeric_columns] <- suppressWarnings(lapply(df[numeric_columns], function(x)as.numeric(x)))\n\n  if (!is.null(save_as) && dir.exists(dirname(save_as))){\n    utils::write.csv(df, save_as, row.names = FALSE)\n  }\n\n  return(df)\n\n}\n\n\n```\n\n\nI did three things to clear this warning:\n- Substitute the *tidyverse* call for the *magrittr*\n- Check if the name spaces \"magrittr\" and \"tabulize\" were available\n- In case they were, load the name space\n- Add *magrittr* and *tabulizer* to the ***Imports*** seciton of the description file\n\nThe updated function is as it follows:\n\n```\npdf_to_tbl <- function(pdf, save_as = NULL) {\n\n  \n  if(!requireNamespace(\"tabulizer\", quietly = TRUE)){\n    warning(\"The tabulizer package is required for this function\")\n    return(NULL)\n  }\n  \n  if(!requireNamespace(\"magrittr\", quietly = TRUE)){\n    warning(\"The magrittr package is required for this function\")\n    return(NULL)\n  }\n  \n  \n  loadNamespace('magrittr')\n \n  \n  \n  plog <- tabulizer::extract_tables(file = pdf, method = \"lattice\")\n  df <- lapply(plog, extract_data_frame_page)\n\n  # identify the numeric columns, since some pages miss all \"Report Number Assigned to Event\"\n  n <- length(df)\n  numeric_columns <- df %>% lapply(., function(x)sapply(x, class)) %>%\n    lapply(., function(x)which(x == \"numeric\")) %>%\n    unlist %>% unique\n\n  ## Combining the different pages\n  df <- do.call(rbind, df)\n  df[numeric_columns] <- suppressWarnings(lapply(df[numeric_columns], function(x)as.numeric(x)))\n\n  if (!is.null(save_as) && dir.exists(dirname(save_as))){\n    utils::write.csv(df, save_as, row.names = FALSE)\n  }\n\n  return(df)\n\n}\n\n```\n\nThe description file now also contains the updated ***Imports*** section\n```\nPackage: Team2\nTitle: Get police presslogs\nVersion: 0.0.0.9000\nAuthors@R: c(\n    person(\"Caio\", \"dos Santos\", , \"clsantos@iastate.edu\", role = c(\"aut\", \"cre\")),\n    person(\"Alexandrea\", \"Arabio\", , \"aarabio@iastate.edu\", role = \"aut\"),\n    person(\"Maxwell\", \"Skinner\", , \"mskinn25@iastate.edu\", role = \"aut\")\n  )\nDescription: This package contains 3 functions to download, extract, and\n    filter presslog data. Also, it contains a sample data set.\nLicense: MIT + file LICENSE\nEncoding: UTF-8\nRoxygen: list(markdown = TRUE)\nRoxygenNote: 7.2.3\nImports: \n    lubridate,\n    tabulizer,\n    magrittr\nDepends: \n    R (>= 2.10)\nLazyData: true\nLitrVersionUsed: 0.7.0\nLitrId: afd1fe153acf34706b65fe5d2dcc1315\n\n```\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}